import Head from 'next/head';
import qs from 'qs';
import Box from '@mui/material/Box';
import Container from '@mui/material/Container';

import { Carousel, Navbar, Paper, Info, Products, Title, Footer, MainSlide } from '../components';

import img1 from '../media/carousel/1.png';
import img2 from '../media/carousel/2.png';
import img3 from '../media/carousel/3.png';

import sofaBg from '../media/banner/sofa.jpeg';
import { fetchAPI } from '../lib/api';
import { ProductsListResponse } from '../lib/apiResponse';
import { toProductsListResponse } from '../lib/formatter';

const Home = ({ popular, recommend }: { popular: ProductsListResponse, recommend: ProductsListResponse }) => {
	return (
		<div>
			<Head>
				<title>Create Next App</title>
				<meta name='description' content='Generated by create next app' />
				<link rel='icon' href='/favicon.ico' />
			</Head>

			<main>
				<Navbar />

				<Carousel
					Slide={MainSlide}
					content={[
						{
							title: 'Lorem ipsum dolor sit amet',
							description:
								'Lacus sed viverra tellus in hac habitasse. Sem nulla pharetra diam sit. Enim diam vulputate ut pharetra sit amet aliquam id. Scelerisque in dictum non consectetur a erat nam. ',
							img: img1,
						},
						{
							title: 'Excepteur sint occaecat cupidatat',
							description:
								'Viverra nam libero justo laoreet sit amet cursus. Tincidunt vitae semper quis lectus nulla at volutpat diam. Nulla aliquet enim tortor at. Aliquet enim tortor at auctor urna nunc id cursus.',
							img: img2,
						},
						{
							title: 'Vulputate odio ut enim blandit volutpat',
							description:
								'Non consectetur a erat nam. Mauris pellentesque pulvinar pellentesque habitant morbi tristique senectus et. Vestibulum rhoncus est pellentesque elit ullamcorper dignissim. Ante metus dictum at tempor.',
							img: img3,
						},
					]}
				/>

				<Box sx={{ mb: '4rem' }}>
					<Container>
						<Title text={'Popular'} />
						<Products
							products={popular.products.data}
						/>
					</Container>
				</Box>

				<Paper
					img={sofaBg}
					element={
						<Info
							title={'Lorem ipsum dolor'}
							description={
								'Lorem ipsum dolor sit amet, consectetur adipisicing elit. Culpa laboriosam laborum laudantium nam quam ullam unde! Ad autem reiciendis tempora. Aut ex impedit laudantium voluptate?'
							}
							price={249}
							link={'/'}
						/>
					}
				/>

				<Box sx={{ mb: '4rem' }}>
					<Container>
						<Title text={'Recommend'} />
						<Products
							products={recommend.products.data}
						/>
					</Container>
				</Box>
			</main>

			<Footer />
		</div>
	);
};

Home.getInitialProps = async () => {
	const queryPopular = qs.stringify({
		filters: {
			isPopular: {
				$eq: true,
			},
		},
		populate: '*',
	});

	const queryRecommend = qs.stringify({
		filters: {
			isRecommend: {
				$eq: true,
			},
		},
		populate: '*',
	});

	const url = '/products?';
	const popularUrl = `${url}${queryPopular}`;
	const recommendUrl = `${url}${queryRecommend}`;

	const popularResponse = await fetchAPI(popularUrl);
	const recommendResponse = await fetchAPI(recommendUrl);

	const popularProducts = toProductsListResponse(popularResponse);
	const recommendProducts = toProductsListResponse(recommendResponse);

	return {
		popular: popularProducts,
		recommend: recommendProducts,
	};
}

export default Home;
